<html>
	<head>
		<meta charset="UTF-8">
  		<link href="static/nouislider.css" rel="stylesheet">
		<script src="static/nouislider.js"></script>
  		<style>
			.noUi-connect {
			    background: cyan;
			}

			.noUi-horizontal .noUi-handle {
			    background: black;
			    box-shadow: none !important;
			}
		</style>

		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>

	</head>
	<h1 style="text-align:center;">PiCocktailMixer</h1>
	<p style="font-size:160%;">Mixe dir deinen eigenen Cocktail oder wähle einen der beliebtesten aus.</p>
	<body>
		<form id="send" method="post" action="/websocket">
				<select id="select_1" name="drink1" onchange="select1()">
						<option value="0">Korn</option>
						<option value="1">Bacardi</option>
						<option value="2">Vodka</option>
						<option value="3">Fanta</option>
						<option value="4">Cola</option>
						<option value="5">Sprite</option>
						<option value="6" selected="">keins</option>
				</select><br>
						<select id="select_2" name="drink2" onchange="select2()">
						<option value="0">Korn</option>
						<option value="1">Bacardi</option>
						<option value="2">Vodka</option>
						<option value="3">Fanta</option>
						<option value="4">Cola</option>
						<option value="5">Sprite</option>
						<option value="6" selected="">keins</option>
				</select><br>
						<select id="select_3" name="drink3" onchange="select3()">
						<option value="0">Korn</option>
						<option value="1">Bacardi</option>
						<option value="2">Vodka</option>
						<option value="3">Fanta</option>
						<option value="4">Cola</option>
						<option value="5">Sprite</option>
						<option value="6" selected="">keins</option>
				</select><br>
						<select id="select_4" name="drink4" onchange="select4()">
						<option value="0">Korn</option>
						<option value="1">Bacardi</option>
						<option value="2">Vodka</option>
						<option value="3">Fanta</option>
						<option value="4">Cola</option>
						<option value="5">Sprite</option>
						<option value="6" selected="">keins</option>
				</select><br>
						<select id="select_5" name="drink5" onchange="select5()">
						<option value="0">Korn</option>
						<option value="1">Bacardi</option>
						<option value="2">Vodka</option>
						<option value="3">Fanta</option>
						<option value="4">Cola</option>
						<option value="5">Sprite</option>
						<option value="6" selected="">keins</option>
				</select><br>
						<select id="select_6" name="drink6" onchange="select6()">
						<option value="0">Korn</option>
						<option value="1">Bacardi</option>
						<option value="2">Vodka</option>
						<option value="3">Fanta</option>
						<option value="4">Cola</option>
						<option value="5">Sprite</option>
						<option value="6" selected="">keins</option>
				</select><br>

				<button type="submit">Bestellen</button>
		</form>
		<p id="demo"></p>
		<p id="demo_one"></p>

		<form id="send" method="post" action="/readycocktail">


		<script>
	// muss in Form geschriben werden	<div id="slider"></div> <!-- Wir erstellen ein leeres Element für den Slider -->

		var drinks = 0;
		var counter1 = 0;
		var counter2 = 0;
		var counter3 = 0;
		var counter4 = 0;
		var counter5 = 0;
		var counter6 = 0;

		function select1() {
			if (document.getElementById("select_1").value != 6 && counter1 == 0) {
				counter1 = counter1 + 1;
				drinks = drinks + 1;
				var x = document.getElementById("select_1").value;
				document.getElementById("demo").innerHTML = "You selected: " + x;
				setGetraenke(drinks)
			}
			else {
				counter1 = counter1 - 1;
				var number = 0;
				number = slider.nouiSlider.get();
				document.getElementById("demo_one").innerHTML = "you selected keins, wert: " + number;
				drinks = drinks - 1;
				setGetraenke(drinks)
			}
		}
		function select2() {
			if (document.getElementById("select_2").value != 6 && counter2 == 0) {
				counter2 = counter2 + 1;
				drinks = drinks + 1;
				var x = document.getElementById("select_2").value;
				document.getElementById("demo").innerHTML = "You selected: " + x;
				setGetraenke(drinks)
			}
			else {
				counter2 = counter2 - 1;
				document.getElementById("demo_one").innerHTML = "you selected keins, drinks: " + drinks;
				drinks = drinks - 1;
				setGetraenke(drinks)
			}
		}
		function select3() {
			if (document.getElementById("select_3").value != 6 && counter3 == 0) {
				counter3 = counter3 + 1;
				drinks = drinks + 1;
				var x = document.getElementById("select_3").value;
				document.getElementById("demo").innerHTML = "You selected: " + x;
				setGetraenke(drinks)
			}
			else {
				counter3 = counter3 - 1;
				document.getElementById("demo_one").innerHTML = "you selected keins, drinks: " + drinks;
				drinks = drinks - 1;
				setGetraenke(drinks)
			}
		}
		function select4() {
			if (document.getElementById("select_4").value != 6 && counter4 == 0) {
				counter4 = counter4 + 1;
				drinks = drinks + 1;
				var x = document.getElementById("select_4").value;
				document.getElementById("demo").innerHTML = "You selected: " + x;
				setGetraenke(drinks)
			}
			else {
				counter4 = counter4 - 1;
				document.getElementById("demo_one").innerHTML = "you selected keins, drinks: " + drinks;
				drinks = drinks - 1;
				setGetraenke(drinks)
			}
		}
		function select5() {
			if (document.getElementById("select_5").value != 6 && counter5 == 0) {
				counter5 = counter5 + 1;
				drinks = drinks + 1;
				var x = document.getElementById("select_5").value;
				document.getElementById("demo").innerHTML = "You selected: " + x;
				setGetraenke(drinks)
			}
			else {
				counter5 = counter5 - 1;
				document.getElementById("demo_one").innerHTML = "you selected keins, drinks: " + drinks;
				drinks = drinks - 1;
				setGetraenke(drinks)
			}
		}
		function select6() {
			if (document.getElementById("select_6").value != 6 && counter6 == 0) {
				counter6 = counter6 + 1;
				drinks = drinks + 1;
				var x = document.getElementById("select_6").value;
				document.getElementById("demo").innerHTML = "You selected: " + x;
				setGetraenke(drinks)
			}
			else {
				counter6 = counter6 - 1;
				document.getElementById("demo_one").innerHTML = "you selected keins, drinks: " + drinks;
				drinks = drinks - 1;
				setGetraenke(drinks)
			}
		}
		</script>
		<div id="slider"></div> <!-- Wir erstellen ein leeres Element für den Slider -->
		<div id="getraenke"></div>  <!-- Und für die Liste -->


		<script>
			// Das Element für den Slider suchen
			var slider = document.getElementById('slider');

			const min = 0 // Konstante für Minimum und
			const max = 100 // Maximum

			// Basis für die Optionen des Sliders
			sliderOptions = {
				connect: true,
		   		range: {
		        	'min': min,
		        	'max': max
		    	},
		    	margin: 5, // Mindestentfernung zwischen einzelnen Handles

		    	// Beschriftung für den Slider
		    	pips: {
		    	    mode: 'steps',
		    	    stepped: true,
		    	    density: 4
		    	},
			}

			function setGetraenke(numGetr) {
				liste = document.getElementById('getraenke')

				str = "<h1>Liste der Getränke</h1>"

				// Für jedes Getränk einen Text hinzufügen
				for (let i = 1; i <= numGetr; i++) {
					str += `<h2>Getränk ${i}: <a id="getraenk-${i}">x</a>%</h2>`
				}

				// Die Getränkeliste updaten
				liste.innerHTML = str;

				// Jetzt den Slider updaten
				makeSlider(slider, numGetr);
			}

			function makeSlider(select, numPoints) {
				// Wenn der Slider bereits initialisiert ist, die Handles zerstören
				if (select.noUiSlider != undefined)
					select.noUiSlider.destroy();

				// Lambda Funktion für die Position der Handles
				mult = (x) => x * ((max - min) / numPoints + min);

				sliderOptions.start = []; // Handles initialisieren
				for (let i = 0; i <= numPoints; i++) {
					sliderOptions.start.push(mult(i)); // Handles einzeln hinzufügen (mit dem Lambda)
				}

				// Den Slider updaten
				noUiSlider.create(select, sliderOptions);

				// Einen Event Listener erstellen
				select.noUiSlider.on('update', function() {
					// Diese Funktion wird ausgeführt, wenn die Position eines Handles sich ändert

					// Alle Werte sammeln
					window.handleValues = select.noUiSlider.get();

					// Einzeln in die Getränkeliste eintragen
					for (let i = 1; i <= numPoints; i++) { // numPoints Equivalent to numGetr
						document.getElementById(`getraenk-${i}`).innerHTML = (window.handleValues[i] - window.handleValues[i-1]).toFixed(2);
					}
				})
			}

			$(document).ready(function() {
					if (!window.WebSocket) {
							if (window.MozWebSocket) {
									window.WebSocket = window.MozWebSocket;
							} else {
									$('#messages').append("<li>Your browser doesn't support WebSockets.</li>");
							}
					}
					ws = new WebSocket('ws://192.168.178.72:8080/websocket');
					ws.onopen = function(evt) {
							$('#messages').append('<li>WebSocket connection opened.</li>');
					}
//					ws.onmessage = function(evt) {
	//						$('#messages').append('<li>' + evt.data + '</li>');
		//			}
					ws.onclose = function(evt) {
							$('#messages').append('<li>WebSocket connection closed.</li>');
					}
					$('#send').submit(function() {
						for (let i = 0; i <= drinks; i++) {
							ws.send(window.handleValues[i]);
						}
		//					ws.onclose();
					});
			});
	//		function selected() {
  //			var x = document.getElementById("select_1").value;
  //			document.getElementById("demo").innerHTML = "You selected: " + x;
	//			setGetraenke(1)
	//		}

			// Beim Laden der Seite erstmal 3 Getränke hinzufügen
	//		setGetraenke(3);

		</script>

	</body>
</html>
